(function(b){var a={init:function(c){var d={timer:null,timerSeconds:10,callback:function(){},timerCurrent:0,showPercentage:false,fill:false,color:"#CCC"};d=b.extend(d,c);return this.each(function(){var f=b(this);var e=f.data("pietimer");if(!e){f.addClass("pietimer");f.css({fontSize:f.width()});f.data("pietimer",d);if(d.showPercentage){f.find(".percent").show()}if(d.fill){f.addClass("fill")}f.pietimer("start")}})},stopWatch:function(){var d=b(this).data("pietimer");if(d){var e=(d.timerFinish-(new Date().getTime()))/1000;if(e<=0){clearInterval(d.timer);b(this).pietimer("drawTimer",100);d.callback()}else{var c=d.timerSeconds-e;b(this).pietimer("drawTimer",c)}}},drawTimer:function(d){$this=b(this);var e=$this.data("pietimer");if(e){$this.html('<div class="percent"></div><div class="slice'+(d>50?' gt50"':'"')+'><div class="pie"></div>'+(d>50?'<div class="pie fill"></div>':"")+"</div>");var c=360/100*d;$this.find(".slice .pie").css({"-moz-transform":"rotate("+c+"deg)","-webkit-transform":"rotate("+c+"deg)","-o-transform":"rotate("+c+"deg)",transform:"rotate("+c+"deg)"});$this.find(".percent").html(Math.round(d)+"%");if(e.showPercentage){$this.find(".percent").show()}if($this.hasClass("fill")){$this.find(".slice .pie").css({backgroundColor:e.color})}else{$this.find(".slice .pie").css({borderColor:e.color})}}},start:function(){var c=b(this).data("pietimer");if(c){c.timerFinish=new Date().getTime()+(c.timerSeconds*1000);b(this).pietimer("drawTimer",0);c.timer=setInterval("$this.pietimer('stopWatch')",50)}},reset:function(){var c=b(this).data("pietimer");if(c){clearInterval(c.timer);b(this).pietimer("drawTimer",0)}}};b.fn.pietimer=function(c){if(a[c]){return a[c].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof c==="object"||!c){return a.init.apply(this,arguments)}else{b.error("Method "+c+" does not exist on jQuery.pietimer")}}}})(jQuery);